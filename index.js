$(document).ready(function(){var n,t,r,e,o;return n=function(n,t){var r,e,o,u,c,i,f,d,l,a;for(e=[],o=0;t>o;++o){for(u=o,c=[],i=0;n>i;++i)f=i,c.push({mine:Math.random()>.9?!0:!1,x:f,y:u});e.push(c)}for(r=e,d=r.reduce(function(n,t){return n.concat(t)},[]),o=0,l=d.length;l>o;++o)a=d[o],a.board=r;return{board:r,flat:d}},t=function(n,r,o){function u(){var t,e,u,c,i,f=[];for(t=-1;1>=t;++t){for(s=t,e=[],u=-1;1>=u;++u)b=u,c=[h+b,l+s],k=c[0],v=c[1],e.push(0>k||0>v||k>=n||v>=r?0:o[(c=(c=l+s)>0?c:0)<(i=r-1)?c:i][(c=(c=h+b)>0?c:0)<(i=n-1)?c:i].mine);f.push(e)}return f}function c(n,t){return n.concat(t)}function i(n,t){return n+t}var f,d,l,a,h,s,b,k,v,p,m,x,y,g;for(f=!1,d=0;r>d;++d)for(l=d,a=0;n>a;++a)if(h=a,o[l][h].check&&!o[l][h].checked&&(o[l][h].show=!0,o[l][h].count=u().reduce(c,[]).reduce(i,0),o[l][h].checked=!0,o[l][h].mine&&(o.failed=!0),0===o[l][h].count))for(f=!0,p=-1;1>=p;++p)for(s=p,m=-1;1>=m;++m)b=m,o[(x=(g=l+s)>0?g:0)<(y=r-1)?x:y][(x=(g=h+b)>0?g:0)<(y=n-1)?x:y].check=!0;return f?t(n,r,o):e(n,r)},r=function(r,o){var u,c,i,f;return u=n(r,o),c=u.board,i=u.flat,f=d3.select("#field").selectAll(".block").data(i),f.enter().append("div").attr({"class":"block"}).style({top:function(n){return 100*(n.y/o)+"%"},left:function(n){return 100*(n.x/r)+"%"},width:function(){return 100/r+"%"},height:function(){return 100/o+"%"}}).on("click",function(n){return n.board.failed?void 0:(n.board[n.y][n.x].check=!0,t(r,o,n.board))}),f.exit().remove(),e(r,o)},e=function(){var n;return n=d3.select("#field").selectAll(".block"),n.text(function(n){var t;return(t=n.count)?t:""}),n.style({background:function(n){return null!=n.count&&n.mine?"#f00":null==n.count?"#ddd":0===n.count?"#fff":"#eee"},color:function(n){return null!=n.count?["#999","#009","#090","#990","#900","#940","#490","#049","#000"][n.count]:"#000"},"font-size":function(){return $(this).width()+"px"},"line-height":function(){return $(this).height()+"px"}}),n},window.reset=o=function(){return r(10,10)},o()});